<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title th:text="#{hydros.header.title}"></title>
<link rel="icon" href="/static/images/favicon.ico/">
<!-- CSS FILES -->
<link rel="stylesheet" data-th-href="@{/webjars/uikit/3.1.5/dist/css/uikit.min.css}" />
<link rel="stylesheet" type="text/css" href="/static/css/dashboard.css">
<!-- JS FILES -->
<script data-th-src="@{/webjars/uikit/3.1.5/dist/js/uikit.min.js}"></script>
<script data-th-src="@{/webjars/uikit/3.1.5/dist/js/uikit-icons.min.js}"></script>
<script data-th-src="@{/webjars/jquery/3.4.1/jquery.min.js}"></script>
<script data-th-src="@{/webjars/jquery-validation/1.17.0-1/jquery.validate.min.js}"></script>
</head>
<script th:inline="javascript">
/*<![CDATA[*/
    var createdMessage = [[#{hydros.alarm.created}]];
    var updatedMessage = [[#{hydros.alarm.updated}]];
    var deletedMessage = [[#{hydros.alarm.deleted}]];
    var emptyMessage = [[#{hydros.alarm.empty}]];
/*]]>*/
</script>
<script type="text/javascript">
$(document)
.ready(
    function() {
        //window.history.pushState({}, document.title, "/clients");
        var status = $("#status").val();
        var errorDesc = $("#errorDesc").val();
        console.log("status: " + status);
        console.log("error: " + errorDesc);
        if (status == "edit") {
            UIkit.modal('#modal-form-edit', {
                modal: false,
                keyboard: false,
                bgclose: false,
                center: true
            }).show();
        }
        if (status == "view") {
            UIkit.modal('#modal-form-view', {
                modal: false,
                keyboard: false,
                bgclose: false,
                center: true
            }).show();
        } else if (status == "created") {
            $("#table-data")
                .before(
                    '<div id="item-created" class="uk-alert-success" uk-alert><a class="uk-alert-close" uk-close></a><p>' + createdMessage + '</p></div>');
        } else if (status == "updated") {
            $("#table-data")
                .before(
                    '<div id="item-updated" class="uk-alert-success" uk-alert><a class="uk-alert-close" uk-close></a><p>' + updatedMessage + '</p></div>');
        } else if (status == "deleted") {
            $("#table-data")
                .before(
                    '<div id="item-deleted" class="uk-alert-danger" uk-alert><a class="uk-alert-close" uk-close></a><p>' + deletedMessage + '</p></div>');
        } else if (status == "empty") {
            $("#table-data")
                .before(
                    '<div id="item-empty" class="uk-alert-primary" uk-alert><a class="uk-alert-close" uk-close></a><p>' + emptyMessage + '</p></div>');
        } else if (status == "error") {
            $("#table-data")
                .before(
                    '<div id="item-deleted" class="uk-alert-danger" uk-alert><a class="uk-alert-close" uk-close></a><p>ERROR: ' + errorDesc + '</p></div>');
        }
    });
</script>

<body>

	<!--HEADER-->
	<div th:replace="fragments/header :: header"></div>
	<!--/HEADER-->
	<!-- LEFT BAR -->
	<div th:replace="fragments/left-bar :: left-bar"></div>
	<!-- /LEFT BAR -->
	<!-- CONTENT -->
	<div id="content" data-uk-height-viewport="expand: true">
		<div class="uk-container uk-container-expand">

			<div id="table-data">
				<h3 class="uk-heading-line uk-text-bold">
					<span th:text="#{hydros.title}"></span>
				</h3>
				<p>
					<a class="uk-button uk-button-default" href="#modal-form" uk-toggle><span data-uk-icon="icon: plus-circle"
						class="uk-margin-small-right"></span><span th:text="#{hydros.addNew}"></span></a>
				</p>

				<!-- 					<h2 th:if="${hydros==null or hydros.empty}" th:text="#{hydros.noHydrosYet}"></h2> -->

				<table id="farms-table" class="uk-table uk-table-hover uk-table-striped uk-table-small">
					<thead>
						<tr>
							<th th:text="#{hydros.table.hydroId}"></th>
							<th th:text="#{hydros.table.clientName}"></th>
							<th th:text="#{hydros.table.dateIni}"></th>
							<th th:text="#{hydros.table.maxWeight}"></th>
							<th>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
							<th>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
							<th>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="hydro : ${hydros}">
							<td th:text="${hydro.id}"></td>
							<td th:text="${hydro.clientId.name}"></td>
							<td th:text="${#dates.format(hydro.dateIni, 'dd-MMM-yyyy')}"></td>
							<td th:text="${hydro.maxWeight}"></td>
							<td><a th:href="@{/view-hydro/{id}(id=${hydro.id})}"><span th:uk-tooltip="#{common.functions.details}"
									data-uk-icon="icon: table" class="uk-margin-small-right"></span></a></td>
							<td><a th:href="@{/edit-hydro/{id}(id=${hydro.id})}"><span th:uk-tooltip="#{common.functions.edit}"
									data-uk-icon="icon: pencil" class="uk-margin-small-right"></span></a></td>
							<td><a data-target="#modal-delete1" th:attr="data-target='#modal-delete'+${hydro.id}" uk-toggle><span
									th:uk-tooltip="#{common.functions.delete}" data-uk-icon="icon: trash" class="uk-margin-small-right "></span></a></td>
							<div th:id="modal-delete+${hydro.id}" uk-modal>
								<div class="uk-modal-dialog">
									<button class="uk-modal-close-default" type="button" uk-close></button>
									<div class="uk-modal-body">
										<h4 th:text="#{hydros.delete.confirmation}" />
										<p th:text="#{hydros.table.hydroId} +': ' + ${hydro.id}"></p>
										<p th:text="#{hydros.table.clientName} +': ' + ${hydro.clientId.name}"></p>
									</div>
									<div class="uk-modal-footer uk-text-right">
										<button class="uk-button uk-button-default uk-modal-close" type="button" th:text="#{common.functions.cancel}"></button>
										<a th:href="@{/delete-hydro/{id}(id=${hydro.id})}"><button class="uk-button uk-button-primary"
												type="button" th:text="#{common.functions.delete}"></button></a>
									</div>
								</div>
							</div>
						</tr>
					</tbody>
				</table>
			</div>

			<div id="modal-form-view" class="uk-modal-container" uk-modal>
				<div class="uk-modal-dialog uk-modal-body">
					<button class="uk-modal-close-full uk-close-large" type="button" uk-close></button>
					<form id="newHydroForm" class="uk-form-horizontal" method="post" action="#" th:object="${editHydro}">
						<div class="uk-modal-header">
							<h2 class="uk-modal-title" th:text="#{hydros.view.title}"></h2>
						</div>
						<div class="uk-modal-body">
							<div class="uk-margin">
								<label class="uk-form-label" th:text="#{hydros.table.hydroId}"></label>
								<div class="uk-form-controls">
									<input class="uk-input uk-form-small" name="hydroId" th:field="*{id}" type="text" disabled>
								</div>
								<label class="uk-form-label" th:text="#{hydros.table.clientId}"></label>
								<div class="uk-form-controls">
									<input class="uk-input uk-form-small" name="clientId" th:field="*{clientId.clientCode}" type="text" disabled>
								</div>
								<label class="uk-form-label" th:text="#{hydros.table.clientName}"></label>
								<div class="uk-form-controls">
									<input class="uk-input uk-form-small" name="clientName" th:field="*{clientId.name}" type="text" disabled>
								</div>
								<label class="uk-form-label" th:text="#{hydros.table.dateIni}"></label>
								<div class="uk-form-controls">
									<input class="uk-input uk-form-small" name="dateIni" th:field="*{dateIni}" type="text" disabled>
								</div>
								<label class="uk-form-label" th:text="#{hydros.table.maxWeight}"></label>
								<div class="uk-form-controls">
									<input class="uk-input uk-form-small" name="maxWeight" th:field="*{maxWeight}" type="text" disabled>
								</div>
							</div>
						</div>
						<div class="uk-position-relative uk-margin-medium">
							<div class="uk-position-top-left uk-margin-small-top">
								<ul class="uk-iconnav">
									<li><a style="text-decoration: none; color: #1e87f0;" th:href="'/print-hydro/'+${id}">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
											th:uk-tooltip="#{common.functions.print}" data-uk-icon="icon: print; ratio: 1.4"
											class="uk-margin-small-right"></span></a></li>
								</ul>
							</div>
						</div>
						<div class="uk-modal-footer uk-text-right">
							<button class="uk-button uk-button-primary uk-modal-close" type="button" th:text="#{common.functions.back}"></button>
						</div>
					</form>
				</div>
			</div>

			<script type="text/javascript">
				$(document).ready(function() {
					$('form').each(function(){
						$(this).validate({	
							rules : {
								clientList : {
									required : true
								},
								maxWeight : {
									required : true,
									number: true
								},
								dateIni : {
									required : true
								}
							},
							errorPlacement : function(error, element) {
								offset = element.offset();
								error.insertBefore(element)
								error.addClass('uk-form-danger');
							},
							errorClass : 'uk-form-danger',
							submitHandler : function(form) { // for demo
								return true;
							}
						});					
					});

					$('#submit-new-button').on('click', function() {
						$('#newHydroForm').valid();
					});
					$('#submit-edit-button').on('click', function() {
						$('#editHydroForm').valid();
					});

				});
			</script>
			
			<div id="modal-form" class="uk-modal-container" uk-modal>
				<div class="uk-modal-dialog uk-modal-body">
					<button class="uk-modal-close-full uk-close-large" type="button" uk-close></button>
					<form id="newHydroForm" class="uk-form-horizontal" method="post" action="#" th:action="@{/add-hydro}"
						th:object="${newHydro}">
						<div class="uk-modal-header">
							<h2 class="uk-modal-title" th:text="#{hydros.addNew.title}"></h2>
						</div>
						<div class="uk-modal-body">
							<div class="uk-margin">
								<label class="uk-form-label" th:text="#{hydros.addNew.client}"></label>
								<div class="uk-form-controls">
									<select class="uk-select uk-form-small" id="clients-list" name="clientList" th:field="*{clientId}">
										<option value="" th:text="#{hydros.addNew.selectClient}"></option>
										<option th:each="client : ${clients}" th:value="${client.clientCode}" th:text="${client.name}"></option>
									</select>
								</div>
								<label class="uk-form-label" th:text="#{hydros.table.dateIni}"></label>
								<div class="uk-form-controls">
									<input class="uk-input uk-form-small" name="dateIni" th:field="*{dateIni}" type="date" placeholder="dd/mm/aaaa">
								</div>
								<label class="uk-form-label" th:text="#{hydros.table.maxWeight}"></label>
								<div class="uk-form-controls">
									<input class="uk-input uk-form-small" name="maxWeight" th:field="*{maxWeight}" type="text" placeholder="620">
								</div>
							</div>
						</div>
						<div class="uk-modal-footer uk-text-right">
							<button class="uk-button uk-button-default uk-modal-close" type="button" th:text="#{common.functions.cancel}"></button>
							<button class="uk-button uk-button-primary" id="submit-new-button" type="submit"
								th:text="#{common.functions.create}"></button>
						</div>
					</form>
				</div>
			</div>
			
			<div id="modal-form-edit" class="uk-modal-container" uk-modal>
				<div class="uk-modal-dialog uk-modal-body">
					<button class="uk-modal-close-full uk-close-large" type="button" uk-close></button>
					<form id="editHydroForm" class="uk-form-horizontal" method="post" action="#" th:action="@{/update-hydro}"
						th:object="${editHydro}">
						<div class="uk-modal-header">
							<h2 class="uk-modal-title" th:text="#{hydros.edit.title}"></h2>
						</div>
						<div class="uk-modal-body">
							<div class="uk-margin">
								<label class="uk-form-label" th:text="#{hydros.addNew.client}"></label>
								<div class="uk-form-controls">
									<select class="uk-select uk-form-small" id="clients-list" name="clientList" th:field="*{clientId}">
										<option value="" th:text="#{hydros.addNew.selectClient}"></option>
										<option th:each="client : ${clients}" th:value="${client.clientCode}" th:text="${client.name}"></option>
									</select>
								</div>
								<input type="hidden" name="hydroId" th:field="*{id}" /> <label class="uk-form-label"
									th:text="#{hydros.table.dateIni}"></label>
								<div class="uk-form-controls">
									<input class="uk-input uk-form-small" name="dateIni" th:field="*{dateIni}" type="date" placeholder="dd/mm/aaaa">
								</div>
								<label class="uk-form-label" th:text="#{hydros.table.maxWeight}"></label>
								<div class="uk-form-controls">
									<input class="uk-input uk-form-small" name="maxWeight" th:field="*{maxWeight}" type="text" placeholder="620">
								</div>
							</div>
						</div>
						<div class="uk-modal-footer uk-text-right">
							<button class="uk-button uk-button-default uk-modal-close" type="button" th:text="#{common.functions.cancel}"></button>
							<button class="uk-button uk-button-primary" id="submit-edit-button" type="submit"
								th:text="#{common.functions.edit}"></button>
						</div>
					</form>
				</div>
			</div>
		
		</div>
		<!-- /CONTENT -->

		<!--FOOTER-->
		<div th:replace="fragments/footer :: footer"></div>
		<!--/FOOTER-->

		<input type="hidden" id="status" name="status" th:value="${status}" /> <input type="hidden" id="errorDesc"
			name="errorDesc" th:value="${errorDesc}" />
	</div>

</body>
</html>
